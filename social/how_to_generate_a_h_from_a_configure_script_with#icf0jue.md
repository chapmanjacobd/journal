there's a rule about not piping `ls` output. I don't know enough about C to help you with the first part of your question
